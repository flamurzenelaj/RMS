{"remainingRequest":"C:\\Users\\PC\\Desktop\\RMS-main\\RMS\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\PC\\Desktop\\RMS-main\\RMS\\src\\views\\EditNews.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\PC\\Desktop\\RMS-main\\RMS\\src\\views\\EditNews.vue","mtime":1675875320598},{"path":"C:\\Users\\PC\\Desktop\\RMS-main\\RMS\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1666293008000},{"path":"C:\\Users\\PC\\Desktop\\RMS-main\\RMS\\node_modules\\babel-loader\\lib\\index.js","mtime":1666293008000},{"path":"C:\\Users\\PC\\Desktop\\RMS-main\\RMS\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1666293008000},{"path":"C:\\Users\\PC\\Desktop\\RMS-main\\RMS\\node_modules\\vue-loader\\lib\\index.js","mtime":1666293008000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBOZXdzQ292ZXJQcmV2aWV3IGZyb20gIi4uL2NvbXBvbmVudHMvTmV3c0NvdmVyUHJldmlldyI7CmltcG9ydCBMb2FkaW5nIGZyb20gIi4uL2NvbXBvbmVudHMvTG9hZGluZyI7CmltcG9ydCBmaXJlYmFzZSBmcm9tICJmaXJlYmFzZS9jb21wYXQvYXBwIjsKaW1wb3J0ICJmaXJlYmFzZS9zdG9yYWdlIjsKaW1wb3J0IGRiIGZyb20gIi4uL2ZpcmViYXNlL2ZpcmViYXNlSW5pdCI7CmltcG9ydCBRdWlsbCBmcm9tICJxdWlsbCI7CndpbmRvdy5RdWlsbCA9IFF1aWxsOwpjb25zdCBJbWFnZVJlc2l6ZSA9IHJlcXVpcmUoInF1aWxsLWltYWdlLXJlc2l6ZS1tb2R1bGUiKS5kZWZhdWx0OwpRdWlsbC5yZWdpc3RlcigibW9kdWxlcy9pbWFnZVJlc2l6ZSIsIEltYWdlUmVzaXplKTsKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICJDcmVhdGVQb3N0IiwKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgZmlsZTogbnVsbCwKICAgICAgZXJyb3I6IG51bGwsCiAgICAgIGVycm9yTXNnOiBudWxsLAogICAgICBsb2FkaW5nOiBudWxsLAogICAgICByb3V0ZUlEOiBudWxsLAogICAgICBjdXJyZW50TmV3czogbnVsbCwKICAgICAgZWRpdG9yU2V0dGluZ3M6IHsKICAgICAgICBtb2R1bGVzOiB7CiAgICAgICAgICBpbWFnZVJlc2l6ZToge30sCiAgICAgICAgfSwKICAgICAgfSwKICAgIH07CiAgfSwKICBjb21wb25lbnRzOiB7CiAgICBOZXdzQ292ZXJQcmV2aWV3LAogICAgTG9hZGluZywKICB9LAogIGFzeW5jIG1vdW50ZWQoKSB7CiAgICB0aGlzLnJvdXRlSUQgPSB0aGlzLiRyb3V0ZS5wYXJhbXMubmV3c2lkOwogICAgdGhpcy5jdXJyZW50TmV3cyA9IGF3YWl0IHRoaXMuJHN0b3JlLnN0YXRlLm5ld3NQb3N0cy5maWx0ZXIoKHBvc3QpID0+IHsKICAgICAgcmV0dXJuIHBvc3QubmV3c0lEID09PSB0aGlzLnJvdXRlSUQ7CiAgICB9KTsKICAgIHRoaXMuJHN0b3JlLmNvbW1pdCgic2V0TmV3c1N0YXRlIiwgdGhpcy5jdXJyZW50TmV3c1swXSk7CiAgfSwKICBtZXRob2RzOiB7CiAgICBmaWxlQ2hhbmdlKCkgewogICAgICB0aGlzLmZpbGUgPSB0aGlzLiRyZWZzLm5ld3NQaG90by5maWxlc1swXTsKICAgICAgY29uc3QgZmlsZU5hbWUgPSB0aGlzLmZpbGUubmFtZTsKICAgICAgdGhpcy4kc3RvcmUuY29tbWl0KCJmaWxlTmFtZUNoYW5nZSIsIGZpbGVOYW1lKTsKICAgICAgdGhpcy4kc3RvcmUuY29tbWl0KCJjcmVhdGVGaWxlVVJMIiwgVVJMLmNyZWF0ZU9iamVjdFVSTCh0aGlzLmZpbGUpKTsKICAgIH0sCgogICAgb3BlblByZXZpZXcoKSB7CiAgICAgIHRoaXMuJHN0b3JlLmNvbW1pdCgib3BlblBob3RvUHJldmlldyIpOwogICAgfSwKCiAgICBpbWFnZUhhbmRsZXIoZmlsZSwgRWRpdG9yLCBjdXJzb3JMb2NhdGlvbiwgcmVzZXRVcGxvYWRlcikgewogICAgICBjb25zdCBzdG9yYWdlUmVmID0gZmlyZWJhc2Uuc3RvcmFnZSgpLnJlZigpOwogICAgICBjb25zdCBkb2NSZWYgPSBzdG9yYWdlUmVmLmNoaWxkKGBkb2N1bWVudHMvbmV3c1Bvc3RQaG90b3MvJHtmaWxlLm5hbWV9YCk7CiAgICAgIGRvY1JlZi5wdXQoZmlsZSkub24oCiAgICAgICAgInN0YXRlX2NoYW5nZWQiLAogICAgICAgIChzbmFwc2hvdCkgPT4gewogICAgICAgICAgY29uc29sZS5sb2coc25hcHNob3QpOwogICAgICAgIH0sCiAgICAgICAgKGVycikgPT4gewogICAgICAgICAgY29uc29sZS5sb2coZXJyKTsKICAgICAgICB9LAogICAgICAgIGFzeW5jICgpID0+IHsKICAgICAgICAgIGNvbnN0IGRvd25sb2FkVVJMID0gYXdhaXQgZG9jUmVmLmdldERvd25sb2FkVVJMKCk7CiAgICAgICAgICBFZGl0b3IuaW5zZXJ0RW1iZWQoY3Vyc29yTG9jYXRpb24sICJpbWFnZSIsIGRvd25sb2FkVVJMKTsKICAgICAgICAgIHJlc2V0VXBsb2FkZXIoKTsKICAgICAgICB9CiAgICAgICk7CiAgICB9LAoKICAgIGFzeW5jIHVwZGF0ZU5ld3MoKSB7CiAgICAgIGNvbnN0IGRhdGFCYXNlID0gYXdhaXQgZGIuY29sbGVjdGlvbigibmV3c1Bvc3RzIikuZG9jKHRoaXMucm91dGVJRCk7CiAgICAgIGlmICh0aGlzLm5ld3NUaXRsZS5sZW5ndGggIT09IDAgJiYgdGhpcy5uZXdzSFRNTC5sZW5ndGggIT09IDApIHsKICAgICAgICBpZiAodGhpcy5maWxlKSB7CiAgICAgICAgICB0aGlzLmxvYWRpbmcgPSB0cnVlOwogICAgICAgICAgY29uc3Qgc3RvcmFnZVJlZiA9IGZpcmViYXNlLnN0b3JhZ2UoKS5yZWYoKTsKICAgICAgICAgIGNvbnN0IGRvY1JlZiA9IHN0b3JhZ2VSZWYuY2hpbGQoYGRvY3VtZW50cy9uZXdzQ292ZXJQaG90b3MvJHt0aGlzLiRzdG9yZS5zdGF0ZS5uZXdzUGhvdG9OYW1lfWApOwogICAgICAgICAgZG9jUmVmLnB1dCh0aGlzLmZpbGUpLm9uKAogICAgICAgICAgICAic3RhdGVfY2hhbmdlZCIsCiAgICAgICAgICAgIChzbmFwc2hvdCkgPT4gewogICAgICAgICAgICAgIGNvbnNvbGUubG9nKHNuYXBzaG90KTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgKGVycikgPT4gewogICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycik7CiAgICAgICAgICAgICAgdGhpcy5sb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGFzeW5jICgpID0+IHsKICAgICAgICAgICAgICBjb25zdCBkb3dubG9hZFVSTCA9IGF3YWl0IGRvY1JlZi5nZXREb3dubG9hZFVSTCgpOwoKICAgICAgICAgICAgICBhd2FpdCBkYXRhQmFzZS51cGRhdGUoewogICAgICAgICAgICAgICAgbmV3c0hUTUw6IHRoaXMubmV3c0hUTUwsCiAgICAgICAgICAgICAgICBuZXdzQ292ZXJQaG90bzogZG93bmxvYWRVUkwsCiAgICAgICAgICAgICAgICBuZXdzQ292ZXJQaG90b05hbWU6IHRoaXMubmV3c0NvdmVyUGhvdG9OYW1lLAogICAgICAgICAgICAgICAgbmV3c1RpdGxlOiB0aGlzLm5ld3NUaXRsZSwKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICBhd2FpdCB0aGlzLiRzdG9yZS5kaXNwYXRjaCgidXBkYXRlUG9zdCIsIHRoaXMucm91dGVJRCk7CiAgICAgICAgICAgICAgdGhpcy5sb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgdGhpcy4kcm91dGVyLnB1c2goeyBuYW1lOiAiVmlld05ld3MiLCBwYXJhbXM6IHsgbmV3c2lkOiBkYXRhQmFzZS5pZCB9IH0pOwogICAgICAgICAgICB9CiAgICAgICAgICApOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICB0aGlzLmxvYWRpbmcgPSB0cnVlOwogICAgICAgIC8vaWYgdGhpcy5maWxlPT1mYWxzZSBtZWFucyB0aGF0IHRoZSBpbWFnZSBoYXNuJ3QgY2hhbmdlZCBzbyB3ZSB1cGRhdGUgb25seSB0aXRsZSBhbmQgZGVzY2lwdGlvbgogICAgICAgIGF3YWl0IGRhdGFCYXNlLnVwZGF0ZSh7CiAgICAgICAgICBuZXdzSFRNTDogdGhpcy5uZXdzSFRNTCwKICAgICAgICAgIG5ld3NUaXRsZTogdGhpcy5uZXdzVGl0bGUsCiAgICAgICAgfSk7CiAgICAgICAgYXdhaXQgdGhpcy4kc3RvcmUuZGlzcGF0Y2goInVwZGF0ZVBvc3QiLCB0aGlzLnJvdXRlSUQpOwogICAgICAgIHRoaXMubG9hZGluZyA9IGZhbHNlOwogICAgICAgIHRoaXMuJHJvdXRlci5wdXNoKHsgbmFtZTogIlZpZXdOZXdzIiwgcGFyYW1zOiB7IG5ld3NpZDogZGF0YUJhc2UuaWQgfSB9KTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgdGhpcy5lcnJvciA9IHRydWU7CiAgICAgIHRoaXMuZXJyb3JNc2cgPSAiUGxlYXNlIGVuc3VyZSBOZXdzIFRpdGxlICYgTmV3cyBQb3N0IGhhcyBiZWVuIGZpbGxlZCEiOwogICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICB0aGlzLmVycm9yID0gZmFsc2U7CiAgICAgIH0sIDUwMDApOwogICAgICByZXR1cm47CiAgICB9LAogIH0sCiAgY29tcHV0ZWQ6IHsKICAgIHByb2ZpbGVJZCgpIHsKICAgICAgcmV0dXJuIHRoaXMuJHN0b3JlLnN0YXRlLnByb2ZpbGVJZDsKICAgIH0sCiAgICBuZXdzQ292ZXJQaG90b05hbWUoKSB7CiAgICAgIHJldHVybiB0aGlzLiRzdG9yZS5zdGF0ZS5uZXdzUGhvdG9OYW1lOwogICAgfSwKICAgIG5ld3NUaXRsZTogewogICAgICBnZXQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuJHN0b3JlLnN0YXRlLm5ld3NUaXRsZTsKICAgICAgfSwKICAgICAgc2V0KHBheWxvYWQpIHsKICAgICAgICB0aGlzLiRzdG9yZS5jb21taXQoInVwZGF0ZW5ld3NUaXRsZSIsIHBheWxvYWQpOwogICAgICB9LAogICAgfSwKICAgIG5ld3NIVE1MOiB7CiAgICAgIGdldCgpIHsKICAgICAgICByZXR1cm4gdGhpcy4kc3RvcmUuc3RhdGUubmV3c0hUTUw7CiAgICAgIH0sCiAgICAgIHNldChwYXlsb2FkKSB7CiAgICAgICAgdGhpcy4kc3RvcmUuY29tbWl0KCJuZXdOZXdzUG9zdCIsIHBheWxvYWQpOwogICAgICB9LAogICAgfSwKICB9LAp9Owo="},{"version":3,"sources":["EditNews.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"EditNews.vue","sourceRoot":"src/views","sourcesContent":["<template>\n  <div class=\"create-post\">\n    <NewsCoverPreview v-show=\"this.$store.state.newsPhotoPreview\" />\n    <Loading v-show=\"loading\" />\n    <div class=\"container\">\n      <div :class=\"{ invisible: !error }\" class=\"err-message\">\n        <p><span>Error:</span>{{ this.errorMsg }}</p>\n      </div>\n      <div class=\"news-info\">\n        <input type=\"text\" placeholder=\"Enter News Title\" v-model=\"newsTitle\" />\n        <div class=\"upload-file\">\n          <label for=\"news-photo\">Upload Cover Photo</label>\n          <input type=\"file\" ref=\"newsPhoto\" id=\"news-photo\" @change=\"fileChange\" accept=\".png, .jpg, ,jpeg\" />\n          <button @click=\"openPreview\" class=\"preview\" :class=\"{ 'button-inactive': !this.$store.state.newsPhotoFileURL }\">\n            Preview Photo\n          </button>\n          <span>File Chosen: {{ this.$store.state.newsPhotoName }}</span>\n        </div>\n      </div>\n      <div class=\"editor\">\n        <vue-editor :editorOptions=\"editorSettings\" v-model=\"newsHTML\" useCustomImageHandler @image-added=\"imageHandler\" />\n      </div>\n      <div class=\"news-actions\">\n        <button @click=\"updateNews\">Save Changes</button>\n        <router-link class=\"router-button\" :to=\"{ name: 'NewsPreview' }\">Preview Changes</router-link>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport NewsCoverPreview from \"../components/NewsCoverPreview\";\nimport Loading from \"../components/Loading\";\nimport firebase from \"firebase/compat/app\";\nimport \"firebase/storage\";\nimport db from \"../firebase/firebaseInit\";\nimport Quill from \"quill\";\nwindow.Quill = Quill;\nconst ImageResize = require(\"quill-image-resize-module\").default;\nQuill.register(\"modules/imageResize\", ImageResize);\nexport default {\n  name: \"CreatePost\",\n  data() {\n    return {\n      file: null,\n      error: null,\n      errorMsg: null,\n      loading: null,\n      routeID: null,\n      currentNews: null,\n      editorSettings: {\n        modules: {\n          imageResize: {},\n        },\n      },\n    };\n  },\n  components: {\n    NewsCoverPreview,\n    Loading,\n  },\n  async mounted() {\n    this.routeID = this.$route.params.newsid;\n    this.currentNews = await this.$store.state.newsPosts.filter((post) => {\n      return post.newsID === this.routeID;\n    });\n    this.$store.commit(\"setNewsState\", this.currentNews[0]);\n  },\n  methods: {\n    fileChange() {\n      this.file = this.$refs.newsPhoto.files[0];\n      const fileName = this.file.name;\n      this.$store.commit(\"fileNameChange\", fileName);\n      this.$store.commit(\"createFileURL\", URL.createObjectURL(this.file));\n    },\n\n    openPreview() {\n      this.$store.commit(\"openPhotoPreview\");\n    },\n\n    imageHandler(file, Editor, cursorLocation, resetUploader) {\n      const storageRef = firebase.storage().ref();\n      const docRef = storageRef.child(`documents/newsPostPhotos/${file.name}`);\n      docRef.put(file).on(\n        \"state_changed\",\n        (snapshot) => {\n          console.log(snapshot);\n        },\n        (err) => {\n          console.log(err);\n        },\n        async () => {\n          const downloadURL = await docRef.getDownloadURL();\n          Editor.insertEmbed(cursorLocation, \"image\", downloadURL);\n          resetUploader();\n        }\n      );\n    },\n\n    async updateNews() {\n      const dataBase = await db.collection(\"newsPosts\").doc(this.routeID);\n      if (this.newsTitle.length !== 0 && this.newsHTML.length !== 0) {\n        if (this.file) {\n          this.loading = true;\n          const storageRef = firebase.storage().ref();\n          const docRef = storageRef.child(`documents/newsCoverPhotos/${this.$store.state.newsPhotoName}`);\n          docRef.put(this.file).on(\n            \"state_changed\",\n            (snapshot) => {\n              console.log(snapshot);\n            },\n            (err) => {\n              console.log(err);\n              this.loading = false;\n            },\n            async () => {\n              const downloadURL = await docRef.getDownloadURL();\n\n              await dataBase.update({\n                newsHTML: this.newsHTML,\n                newsCoverPhoto: downloadURL,\n                newsCoverPhotoName: this.newsCoverPhotoName,\n                newsTitle: this.newsTitle,\n              });\n              await this.$store.dispatch(\"updatePost\", this.routeID);\n              this.loading = false;\n              this.$router.push({ name: \"ViewNews\", params: { newsid: dataBase.id } });\n            }\n          );\n          return;\n        }\n        this.loading = true;\n        //if this.file==false means that the image hasn't changed so we update only title and desciption\n        await dataBase.update({\n          newsHTML: this.newsHTML,\n          newsTitle: this.newsTitle,\n        });\n        await this.$store.dispatch(\"updatePost\", this.routeID);\n        this.loading = false;\n        this.$router.push({ name: \"ViewNews\", params: { newsid: dataBase.id } });\n        return;\n      }\n      this.error = true;\n      this.errorMsg = \"Please ensure News Title & News Post has been filled!\";\n      setTimeout(() => {\n        this.error = false;\n      }, 5000);\n      return;\n    },\n  },\n  computed: {\n    profileId() {\n      return this.$store.state.profileId;\n    },\n    newsCoverPhotoName() {\n      return this.$store.state.newsPhotoName;\n    },\n    newsTitle: {\n      get() {\n        return this.$store.state.newsTitle;\n      },\n      set(payload) {\n        this.$store.commit(\"updatenewsTitle\", payload);\n      },\n    },\n    newsHTML: {\n      get() {\n        return this.$store.state.newsHTML;\n      },\n      set(payload) {\n        this.$store.commit(\"newNewsPost\", payload);\n      },\n    },\n  },\n};\n</script>\n\n<style lang=\"scss\">\n.create-post {\n  position: relative;\n  height: 100%;\n\n  button {\n    margin-top: 0;\n  }\n\n  .router-button {\n    text-decoration: none;\n    color: #fff;\n  }\n\n  label,\n  button,\n  .router-button {\n    transition: 0.5s ease-in-out all;\n    align-self: center;\n    font-size: 14px;\n    cursor: pointer;\n    border-radius: 20px;\n    padding: 12px 24px;\n    color: #fff;\n    background-color: #303030;\n    text-decoration: none;\n\n    &:hover {\n      background-color: rgba(48, 48, 48, 0.7);\n    }\n  }\n\n  .container {\n    position: relative;\n    height: 100%;\n    padding: 10px 25px 60px;\n  }\n\n  // error styling\n  .invisible {\n    opacity: 0 !important;\n  }\n\n  .err-message {\n    width: 100%;\n    padding: 12px;\n    border-radius: 8px;\n    color: #fff;\n    margin-bottom: 10px;\n    background-color: #303030;\n    opacity: 1;\n    transition: 0.5s ease all;\n\n    p {\n      font-size: 14px;\n    }\n\n    span {\n      font-weight: 600;\n    }\n  }\n\n  .news-info {\n    display: flex;\n    margin-bottom: 32px;\n\n    input:nth-child(1) {\n      min-width: 300px;\n    }\n\n    input {\n      transition: 0.5s ease-in-out all;\n      padding: 10px 4px;\n      border: none;\n      border-bottom: 1px solid #303030;\n\n      &:focus {\n        outline: none;\n        box-shadow: 0 1px 0 0 #303030;\n      }\n    }\n\n    .upload-file {\n      flex: 1;\n      margin-left: 16px;\n      position: relative;\n      display: flex;\n\n      input {\n        display: none;\n      }\n\n      .preview {\n        margin-left: 16px;\n        text-transform: initial;\n      }\n\n      span {\n        font-size: 12px;\n        margin-left: 16px;\n        align-self: center;\n      }\n    }\n  }\n\n  .editor {\n    height: 60vh;\n    display: flex;\n    flex-direction: column;\n\n    .quillWrapper {\n      position: relative;\n      display: flex;\n      flex-direction: column;\n      height: 100%;\n    }\n\n    .ql-container {\n      display: flex;\n      flex-direction: column;\n      height: 100%;\n      overflow: scroll;\n    }\n\n    .ql-editor {\n      padding: 20px 16px 30px;\n    }\n  }\n\n  .news-actions {\n    margin-top: 32px;\n\n    button {\n      margin-right: 16px;\n    }\n  }\n}\n</style>\n"]}]}